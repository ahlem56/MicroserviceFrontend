<div class="complaint-list-container">
  <div class="header">
    <h1>Complaints' List</h1>
  </div>

  <!-- Filter Controls -->
  <div class="filter-controls">
    <div class="filter-select">
      <button class="btn btn-primary" [class.active]="filterType === 'all'" (click)="applyFilter('all')">All</button>
      <button class="btn btn-warning" [class.active]="filterType === 'pending'" (click)="applyFilter('pending')">Pending</button>
      <button class="btn btn-danger" [class.active]="filterType === 'ignored'" (click)="applyFilter('ignored')">Ignored</button>
      <button class="btn btn-success" [class.active]="filterType === 'resolved'" (click)="applyFilter('resolved')">Resolved</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  @if (isLoading) {
    <div class="loading-overlay">
      <i class="fas fa-spinner fa-spin"></i> Loading...
    </div>
  }

  <!-- Complaints Table -->
  @if (!isLoading && filteredComplaints.length > 0) {
    <div class="complaint-table">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>User ID</th>
            <th>Created Date</th>
            <th>Description</th>
            <th>Severity</th>
            <th>Status</th>
            <th>Actions</th>
            @if (filterType === 'resolved') {
              <th>Admin's Response</th>
            }
            @if (filterType === 'pending') {
              <th>Actions</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (complaint of filteredComplaints; track complaint.complaintId) {
            <tr>
              <td data-label="ID">{{ complaint.reportId || complaint.complaintId || complaint.id || 'N/A' }}</td>
              <td data-label="User ID">{{ complaint.userId || complaint.simpleUser?.userId || 'N/A' }}</td>
              <td data-label="Created Date">{{ complaint.displayCreatedDate || complaint.createdDate || complaint.created_at || complaint.created_date || 'N/A' }}</td>
              <td data-label="Description">{{ complaint.issueDescription || complaint.issue_description || complaint.description || complaint.complaintDescription || 'N/A' }}</td>
              <td data-label="Severity">
                <div class="severity-dots" [title]="(complaint.severity || 'unknown') + ' severity'" role="img" [attr.aria-label]="(complaint.severity || 'unknown') + ' severity'">
                  <span
                    *ngFor="let _ of [].constructor(getSeverityDots(complaint.severity || ''))"
                    class="severity-dot"
                    [style.backgroundColor]="getSeverityColor(complaint.severity || '')"
                  ></span>
                </div>
              </td>
              <td data-label="Status" [ngClass]="{
                'status-pending': complaint.complaintStatus === 'pending',
                'status-ignored': complaint.complaintStatus === 'ignored',
                'status-resolved': complaint.complaintStatus === 'resolved'
              }">
                {{ (complaint.complaintStatus || complaint.status || 'unknown') | titlecase }}
              </td>
              <td data-label="Actions">
                <button class="btn btn-sm btn-primary" (click)="onEditComplaint(complaint)">Update</button>
                <button class="btn btn-sm btn-danger" (click)="onDeleteComplaint(complaint)">Delete</button>
              </td>
              @if (filterType === 'resolved') {
                <td data-label="Admin's Response">{{ complaint.response || 'No response available' }}</td>
              }
              @if (filterType === 'pending') {
                <td data-label="Actions">
                  <button class="btn btn-danger" (click)="viewDetails(complaint.complaintId)">Details</button>
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else if (!isLoading) {
    <p class="no-results">There are no complaints.</p>
  }
</div>